<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8">
        <title>AJAX and JSON Web Services</title>

    </head>
    <body>

       <h2>AJAX and JSON - API Web Services</h2>
        <hr>

        <p>Select a city from the list below</p>

        <form name="list">
            <input type="radio" name="city" value="5368361" id="one"><label for="one">Los Angeles</label>
            <input type="radio" name="city" value="5128581" id="two"><label for="two">New York City</label>
            <input type="radio" name="city" value="4560349" id="three"><label for="three">Philadelphia</label>
        </form>

        <button id="btn" type="button">Check Weather</button>

        <div id="wrapper">
            <ul>
                <li id="info1"></li>
                <li id="info2"></li>
                <li id="info3"></li>

            </ul>
        </div>


        <div id="result">
           <button type="button" onclick="loadDoc()">Request Data</button>
            <p id="joke"></p>
        </div>

        <script>


            // create a variable to hold the html button item
            var btn = document.getElementById("btn");

            // add an event listener to the button
            btn.addEventListener('click', function(){

                // retrieve the value from the radio button checked
               var city = document.forms.list.city.value;

               // create an instance of XMLHttpRequest
               var request = new XMLHttpRequest();

               // establish the connection
               request.open('GET','https://api.weatherbit.io/v2.0/current?city_id='+city+'&key=716636b2f5704a17a4cbcf73c09dde64');

               request.onreadystatechange = function() {
                    if(this.readyState === 4 && this.status === 200) {
                        // if the request is successfully completed, then go ahead
                        request.onload = function() {

                        // parse the JSON string returned by the API web service server
                        var data = JSON.parse(request.responseText);

                        // print the parsed data into the console (for debugging purpose)
                        console.log(data);

                       // call for the function responsible to display the data in the html page
                       fillHTMLelement(data);
                       }
                   }
               }

               request.send();
           });


          function fillHTMLelement(info){

              var city = info.data[0].city_name;
              var temperature = info.data[0].temp;
              var desc = info.data[0].weather.description;

              document.getElementById('info1').innerHTML = city;
              document.getElementById('info2').innerHTML = temperature + " C&deg;";
              document.getElementById('info3').innerHTML = desc;
          }




           function loadDoc() {

               var data = null;

               var request = new XMLHttpRequest();
              // request.withCredentials = true;

               // defining event listener for ready state change event
              // request.addEventListener("readystatechange", function () {
	           request.onreadystatechange = function() {
                    //if (this.readyState === this.DONE) {
                    if(this.readyState === 4 && this.status === 200) {
		              console.log(this.responseText);

                      var joke = JSON.parse(this.responseText);
                      //document.getElementById("joke").innerHTML = joke.value;
                        document.getElementById("joke").innerHTML = joke;
	               }
               };

               //instantiating the request object
              // request.open("GET", "https://matchilling-chuck-norris-jokes-v1.p.rapidapi.com/jokes/random");
               //request.setRequestHeader("x-rapidapi-host", "matchilling-chuck-norris-jokes-v1.p.rapidapi.com");
              // request.setRequestHeader("x-rapidapi-key", "7b508a6649msh867677fea66a1a7p110310jsna91c7ea08972");
              //  request.setRequestHeader("accept", "application/json");

               request.open("GET", "https://geek-jokes.sameerkumar.website/api");
               request.setRequestHeader("accept", "application/json");
               request.send(data);


           }




        </script>



    </body>
</html>
